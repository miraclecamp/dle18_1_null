var c_cache=[],p_cache=[],dle_poll_voted=[],file_uploaders=[],active_comments_editor=null;function reload(){var e=(new Date).getTime();document.getElementById("dle-captcha").innerHTML='<img src="'+dle_root+"engine/modules/antibot/antibot.php?rndval="+e+'" width="160" height="80" alt="" />'}function dle_change_sort(e,t){var o=document.getElementById("news_set_sort");return o.dlenewssortby.value=e,o.dledirection.value=t,o.submit(),!1}function doPoll(e,t){var o=document.getElementById("dlepollform_"+t),n=o.status.value,i="";if(1!=dle_poll_voted[t]){if("results"!=e&&1!=n){for(var d=0;d<o.elements.length;d++){var a=o.elements[d];if("radio"==a.type&&1==a.checked){i=a.value;break}"checkbox"==a.type&&1==a.checked&&(i=i+a.value+" ")}if("vote"==e&&""==i)return;dle_poll_voted[t]=1}else n=1,o.status.value=1;1==n&&"vote"==e&&(n=0,o.status.value=0,e="list"),ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=poll",{news_id:t,action:e,answer:i,dle_skin:dle_skin,user_hash:dle_login_hash},function(e){HideLoading(""),$("#dle-poll-list-"+t).fadeOut(500,function(){$(this).html(e),$(this).fadeIn(500)})})}}function IPMenu(e,t,o,n){var i=[];return i[0]='<a href="https://www.nic.ru/whois/?searchWord='+e+'" target="_blank">'+t+"</a>",i[1]='<a href="'+dle_root+dle_admin+"?mod=iptools&ip="+e+'" target="_blank">'+o+"</a>",i[2]='<a href="'+dle_root+dle_admin+"?mod=blockip&ip="+e+'" target="_blank">'+n+"</a>",i}function ajax_save_for_edit(e,t){tinyMCE.triggerSave();var o=new FormData($("#ajaxnews"+e)[0]);return o.append("id",e),o.append("field",t),o.append("action","save"),o.append("user_hash",dle_login_hash),ShowLoading(""),$.ajax({url:dle_root+"engine/ajax/controller.php?mod=editnews",data:o,processData:!1,contentType:!1,type:"POST",dataType:"html",success:function(e){HideLoading(""),"ok"!=e?DLEPush.error(e):($("#dlepopup-news-edit").dialog("close"),DLEconfirm(dle_save_ok,dle_confirm,function(){location.reload(!0)}))}}),!1}function ajax_prep_for_edit(i,d){for(var e=0,t=c_cache.length;e<t;e++)e in c_cache&&(!c_cache[e]&&""==c_cache[e]||ajax_cancel_comm_edit(e));return ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=editnews",{id:i,field:d,action:"edit"},function(e){HideLoading("");var o="none";$("#modal-overlay").remove(),$("body").prepend('<div id="modal-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #666666; opacity: .40; z-index: 980; display:none;"></div>'),$("#modal-overlay").fadeIn();var t={};t[dle_act_lang[3]]=function(){$(this).dialog("close")},t[dle_act_lang[4]]=function(){ajax_save_for_edit(i,d)},$("#dlepopup-news-edit").remove(),$("body").prepend("<div id='dlepopup-news-edit' class='dlepopupnewsedit' title='"+menu_short+"' style='display:none'></div>"),$("#dlepopup-news-edit").html(e);var n=1024*getBaseSize();n>.95*$(window).width()&&(n=.95*$(window).width());e=.85*$(window).height();800<e&&(e=800),$("#dlepopup-news-edit").dialog({autoOpen:!0,width:n,height:e,buttons:t,resizable:!1,dialogClass:"modalfixed dle-popup-quickedit",dragStart:function(e,t){o=$(".modalfixed").css("box-shadow"),$(".modalfixed").css("box-shadow","none")},dragStop:function(e,t){$(".modalfixed").css("box-shadow",o)},close:function(e,t){$(this).dialog("destroy"),$("#modal-overlay").fadeOut(function(){$("#modal-overlay").remove()})}}),830<$(window).width()&&530<$(window).height()&&($(".modalfixed.ui-dialog").css({position:"fixed"}),$("#dlepopup-news-edit").dialog("option","position",{my:"center",at:"center",of:window})),$("#dlepopup-news-edit").css({overflow:"auto"}),$("#dlepopup-news-edit").css({"overflow-x":"hidden"})},"html"),!1}function ajax_comm_edit(t,e){for(var o=0,n=c_cache.length;o<n;o++)o in c_cache&&""!=c_cache[o]&&ajax_cancel_comm_edit(o);return c_cache[t]&&""!=c_cache[t]||(c_cache[t]=$("#comm-id-"+t).html()),ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=editcomments",{id:t,area:e,action:"edit"},function(e){HideLoading(""),active_comments_editor="comm-id-"+t,$("#comm-id-"+t).html(e),setTimeout(function(){scrollToCenterPosition("#comment-id-"+t)},300)},"html"),!1}function ajax_cancel_comm_edit(e){return active_comments_editor=null,""!=c_cache[e]&&$("#comm-id-"+e).html(c_cache[e]),c_cache[e]="",$('[data-commentsgallery="'+e+'"]').show(),!1}function ajax_save_comm_edit(o,n){if("selected"==$("#comments-image-uploader-edit").data("files"))return $("#comments-image-uploader-edit").on("complete",function(e,t){HideLoading(""),$("#comments-image-uploader-edit").data("files","uploaded"),ajax_save_comm_edit(o,n)}),$("#comments-image-uploader-edit").plupload("start"),!1;dle_wysiwyg&&tinyMCE.triggerSave();var e,t=$("#dleeditcomments"+o).val();return e=$("#c_edit_autor"+o).val()?$("#c_edit_autor"+o).val():"",ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=editcomments",{id:o,name:e,comm_txt:t,area:n,action:"save",user_hash:dle_login_hash},function(e){HideLoading(""),e.success?(c_cache[o]="",$("#comm-id-"+o).html(e.content),scrollToCenterPosition("#comment-id-"+o),active_comments_editor=null):e.error&&DLEPush.error(e.message),$('[data-commentsgallery="'+o+'"]').show()},"json"),!1}function DeleteComments(e,t){DLEconfirmDelete(dle_del_agree,dle_confirm,function(){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=deletecomments",{id:e,dle_allow_hash:t},function(e){var t;HideLoading(""),e=parseInt(e),isNaN(e)||(t="#comment-id-"+e,"1"==dle_tree_comm&&(t="#comments-tree-item-"+e),scrollToCenterPosition(t,function(){$(t).hide("blind",{},500)}))})})}function MarkSpam(e,t){DLEconfirm(dle_spam_agree,dle_confirm,function(){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=adminfunction",{id:e,action:"commentsspam",user_hash:t},function(e){HideLoading(""),"error"!=e&&location.reload(!0)})})}function doFavorites(t,e,o,n){return ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=favorites",{fav_id:t,action:e,module:n,skin:dle_skin,alert:o,user_hash:dle_login_hash},function(e){HideLoading(""),e.success?(o?DLEPush.info(e.content):$('[data-fav-id="'+t+'"]').html(e.content),e.modify&&e.modify.del_fav_html?($('[data-favorites-add="'+t+'"]').next().remove(),$('[data-favorites-del="'+t+'"]').after(e.modify.del_fav_html)):e.modify&&e.modify.add_fav_html&&($('[data-favorites-del="'+t+'"]').next().remove(),$('[data-favorites-add="'+t+'"]').after(e.modify.add_fav_html))):e.error&&DLEPush.error(e.content)},"json"),!1}function CheckLogin(){var e=document.getElementById("name").value;return ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=registration",{name:e,user_hash:dle_login_hash},function(e){HideLoading(""),e.success?DLEPush.info(e.message):DLEPush.error(e.message)},"json"),!1}function doCalendar(e,t,o){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=calendar",{month:e,year:t},function(e){HideLoading(""),"left"==o?$("#calendar-layer").hide("slide",{direction:"left"},500,function(){$("#calendar-layer").html(e).show("slide",{direction:"right"},500)}):$("#calendar-layer").hide("slide",{direction:"right"},500,function(){$("#calendar-layer").html(e).show("slide",{direction:"left"},500)})})}function doRate(e,o){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=rating",{go_rate:e,news_id:o,skin:dle_skin,user_hash:dle_login_hash},function(e){var t;HideLoading(""),e.success?(t=(t=(t=(t=e.rating).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&"),$('[data-ratig-layer-id="'+o+'"]').html(t),$('[data-vote-num-id="'+o+'"]').html(e.votenum),$('[data-likes-id="'+o+'"]').html(e.likes),$('[data-dislikes-id="'+o+'"]').html(e.dislikes)):e.error&&DLEPush.error(e.errorinfo)},"json")}function doCommentsRate(e,o){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=ratingcomments",{go_rate:e,c_id:o,skin:dle_skin,user_hash:dle_login_hash},function(e){var t;HideLoading(""),e.success?(t=(t=(t=(t=e.rating).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&"),$('[data-comments-ratig-layer-id="'+o+'"]').html(t),$('[data-comments-vote-num-id="'+o+'"]').html(e.votenum),$('[data-comments-likes-id="'+o+'"]').html(e.likes),$('[data-comments-dislikes-id="'+o+'"]').html(e.dislikes)):e.error&&DLEPush.error(e.errorinfo)},"json")}function ajax_cancel_reply(){active_comments_editor=null,$("#dlefastreplycomments").hide("blind",{},500)}function DLESendPM(e){var l={},t=800*getBaseSize();return t>.95*$(window).width()&&(t=.95*$(window).width()),$("#dlesendpmpopup").remove(),$("#dleprofilepopup").remove(),l[dle_act_lang[3]]=function(){$(this).dialog("close")},l[dle_p_send]=function(){tinyMCE.triggerSave();var e=$("#pm_subj").val(),t=$("#pm_text").val(),o=$("#pm_name").val(),n=$("#pm_question_answer").val(),i=$("#sec_code_pm").val(),d="";if(""==o)return DLEPush.error(dle_req_field[0]),!1;if(""==t)return DLEPush.error(dle_req_field[1]),!1;if(""==e)return DLEPush.error(dle_req_field[2]),!1;if("1"==dle_captcha_type)"undefined"!=typeof grecaptcha&&(d=grecaptcha.getResponse(recaptcha_widget));else if("2"==dle_captcha_type&&"undefined"!=typeof grecaptcha){if(""==(d=$("#pm-recaptcha-response").val())){var a=$("#pm-recaptcha-response").data("key");return grecaptcha.execute(a,{action:"personal_message"}).then(function(e){$("#pm-recaptcha-response").val(e),l[dle_p_send]()}),!1}}else"3"==dle_captcha_type?"undefined"!=typeof hcaptcha&&(d=hcaptcha.getResponse(recaptcha_widget)):"4"==dle_captcha_type&&"undefined"!=typeof turnstile&&(d=turnstile.getResponse(recaptcha_widget));return i=i||"",n=n||"",ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=pm",{action:"send_pm",subj:e,comments:t,name:o,skin:dle_skin,sec_code:i,question_answer:n,g_recaptcha_response:d,user_hash:dle_login_hash},function(e){var t;HideLoading(""),e.success?($("#dlesendpmpopup").dialog("close"),$("#dlesendpmpopup").remove(),DLEPush.info(e.success)):e.error&&("2"==dle_captcha_type?"undefined"!=typeof grecaptcha&&(t=$("#pm-recaptcha-response").data("key"),grecaptcha.execute(t,{action:"pm"}).then(function(e){$("#pm-recaptcha-response").val(e)})):"4"==dle_captcha_type?"undefined"!=typeof turnstile&&turnstile.reset(recaptcha_widget):"3"==dle_captcha_type?"undefined"!=typeof hcaptcha&&hcaptcha.reset(recaptcha_widget):"1"==dle_captcha_type&&"undefined"!=typeof grecaptcha&&grecaptcha.reset(recaptcha_widget),DLEPush.error(e.error))},"json"),!1},ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=pm",{name:e,action:"show_send",skin:dle_skin,user_hash:dle_login_hash},function(e){HideLoading(""),$("body").append(e),$("#dlesendpmpopup").dialog({autoOpen:!0,width:t,resizable:!1,dialogClass:"modalfixed dle-popup-sendpm",buttons:l}),$(".modalfixed.ui-dialog").css({position:"fixed"}),$(".dle-popup-sendpm").css({cssText:"width:"+t+"px;max-height: none !important"}),$("#dlesendpmpopup").css({cssText:"height: auto !important"}),$("#dlesendpmpopup").dialog("option","position",{my:"center",at:"center",of:window})},"html"),!1}function ajax_fast_reply(o,n,i){var e="";dle_wysiwyg&&(tinyMCE.triggerSave(),e="wysiwyg");var t=$("#comments"+o).val(),d=$("#name"+o).val(),a=$("#mail"+o).val(),l=$("#question_answer"+o).val(),r=$("#sec_code"+o).val(),s=$("#subscribe"+o+":checked").val(),c=$("#postid"+o).val(),p="";if(""==d)return DLEPush.error(dle_req_field[0]),!1;if(""==t)return DLEPush.error(dle_req_field[1]),!1;if("1"==dle_captcha_type)"undefined"!=typeof grecaptcha&&(p=grecaptcha.getResponse(recaptcha_widget));else if("2"==dle_captcha_type&&"undefined"!=typeof grecaptcha){if(""==(p=$("#comments-recaptcha-response"+o).val())){var m=$("#comments-recaptcha-response"+o).data("key");return grecaptcha.execute(m,{action:"comments"}).then(function(e){$("#comments-recaptcha-response"+o).val(e),ajax_fast_reply(o,n,i)}),!1}}else"3"==dle_captcha_type?"undefined"!=typeof hcaptcha&&(p=hcaptcha.getResponse(recaptcha_widget)):"4"==dle_captcha_type&&"undefined"!=typeof turnstile&&(p=turnstile.getResponse(recaptcha_widget));return"selected"==$("#comments-image-uploader-reply").data("files")?($("#comments-image-uploader-reply").on("complete",function(e,t){HideLoading(""),$("#comments-image-uploader-reply").data("files","uploaded"),ajax_fast_reply(o,n,i)}),$("#comments-image-uploader-reply").plupload("start")):(s=s||0,r=r||"",l=l||"",ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=addcomments",{post_id:c,parent:o,indent:n,comments:t,name:d,mail:a,editor_mode:e,skin:dle_skin,sec_code:r,question_answer:l,g_recaptcha_response:p,allow_subscribe:s,user_hash:dle_login_hash,needwrap:i},function(e){var t;HideLoading(""),e.error?$(e.content).insertBefore("#dlefastreplyesponse"):e.success&&(active_comments_editor=null,$("#comm-id-"+e.id).length?(t=$(e.content).find("#comm-id-"+e.id).html(),$("#dlefastreplycomments").hide(),scrollToCenterPosition("#comment-id-"+e.id,function(){$("#comm-id-"+e.id).fadeOut(300,function(){$(this).html(t+"<script>"+e.scripts+"<\/script>"),$("#comm-id-"+e.id).fadeIn(300)})})):($(e.content+"<script>"+e.scripts+"<\/script>").insertBefore("#dlefastreplyesponse"),$("#dlefastreplycomments").hide("blind",{},500),setTimeout(function(){scrollToCenterPosition("#dlefastreplyesponse",function(){$("#comments-tree-item-"+e.id).show("blind",{},500)})},500)))},"json")),!1}function dle_reply(s,c,t){var p={},m="",u=0,o=800*getBaseSize();return o>.95*$(window).width()&&(o=.95*$(window).width()),$("#dlereplypopup").remove(),$("#dlefastreplyesponse").remove(),$("#dlefastreplycomments").remove(),$("#comment-id-"+s).next(".comments-tree-list").length?$("#comment-id-"+s).next(".comments-tree-list").append("<div id='dlefastreplyesponse'></div>"):($("<div id='dlefastreplyesponse'></div>").insertAfter("#comment-id-"+s),u=1),p[dle_act_lang[3]]=function(){$(this).dialog("close")},p[dle_p_send]=function(){dle_wysiwyg&&(tinyMCE.triggerSave(),m="wysiwyg");var e=$("#comments"+s).val(),t=$("#name"+s).val(),o=$("#mail"+s).val(),n=$("#question_answer"+s).val(),i=$("#sec_code"+s).val(),d=$("#subscribe"+s+":checked").val(),a=$("#postid"+s).val(),l="";if(""==t)return DLEPush.error(dle_req_field[0]),!1;if(""==e)return DLEPush.error(dle_req_field[1]),!1;if("1"==dle_captcha_type)"undefined"!=typeof grecaptcha&&(l=grecaptcha.getResponse(recaptcha_widget));else if("2"==dle_captcha_type&&"undefined"!=typeof grecaptcha){if(""==(l=$("#comments-recaptcha-response"+s).val())){var r=$("#comments-recaptcha-response"+s).data("key");return grecaptcha.execute(r,{action:"comments"}).then(function(e){$("#comments-recaptcha-response"+s).val(e),p[dle_p_send]()}),!1}}else"3"==dle_captcha_type?"undefined"!=typeof hcaptcha&&(l=hcaptcha.getResponse(recaptcha_widget)):"4"==dle_captcha_type&&"undefined"!=typeof turnstile&&(l=turnstile.getResponse(recaptcha_widget));return"selected"==$("#comments-image-uploader-reply").data("files")?($("#comments-image-uploader-reply").on("complete",function(e,t){HideLoading(""),$("#comments-image-uploader-reply").data("files","uploaded"),p[dle_p_send]()}),$("#comments-image-uploader-reply").plupload("start")):(d=d||0,i=i||"",n=n||"",ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=addcomments",{post_id:a,parent:s,indent:c,comments:e,name:t,mail:o,editor_mode:m,skin:dle_skin,sec_code:i,question_answer:n,g_recaptcha_response:l,allow_subscribe:d,user_hash:dle_login_hash,needwrap:u},function(e){var t;HideLoading(""),e.error?$(e.content).insertBefore("#dlefastreplyesponse"):e.success&&($("#dlereplypopup").remove(),$("#comm-id-"+e.id).length?(t=$(e.content).find("#comm-id-"+e.id).html(),$("#dlefastreplycomments").hide(),scrollToCenterPosition("#comment-id-"+e.id,function(){$("#comm-id-"+e.id).fadeOut("slow",function(){$(this).html(t+"<script>"+e.scripts+"<\/script>"),$("#comm-id-"+e.id).fadeIn("slow")})})):($(e.content+"<script>"+e.scripts+"<\/script>").insertBefore("#dlefastreplyesponse"),$("#dlefastreplycomments").hide("blind",{},500),setTimeout(function(){scrollToCenterPosition("#dlefastreplyesponse",function(){$("#comments-tree-item-"+e.id).show("blind",{},500)})},500)))},"json")),!1},ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=replycomments",{id:s,indent:c,skin:dle_skin,user_hash:dle_login_hash,needwrap:u},function(e){HideLoading(""),active_comments_editor="dle-comments-form-"+s,"0"!=t?($("<div id='dlefastreplycomments'></div>").insertAfter("#comment-id-"+s),$("#dlefastreplycomments").html(e),setTimeout(function(){scrollToCenterPosition("#dlefastreplycomments")},300)):($("body").append("<div id='dlereplypopup' title='"+dle_reply_title+"' style='display:none'></div>"),$("#dlereplypopup").html(e),$("#dlereplypopup").dialog({autoOpen:!0,width:o,resizable:!1,dialogClass:"modalfixed dle-popup-replycomments",buttons:p}),$(".modalfixed.ui-dialog").css({position:"fixed"}),$(".dle-popup-replycomments").css({cssText:"width:"+o+"px; max-height: none !important"}),$("#dlereplypopup").css({cssText:"height: auto !important"}),$("#dlereplypopup").dialog("option","position",{my:"center",at:"center",of:window}))},"html"),!1}function ajax_pm_edit(t){for(var e=0,o=p_cache.length;e<o;e++)e in p_cache&&""!=p_cache[e]&&ajax_cancel_pm_edit(e);return p_cache[t]&&""!=p_cache[t]||(p_cache[t]=$("#pm-id-"+t).html()),ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=pm",{id:t,action:"edit",user_hash:dle_login_hash},function(e){HideLoading(""),active_comments_editor="pm-id-"+t,e.success?($("#pm-id-"+t).html(e.response),setTimeout(function(){scrollToCenterPosition("#pm-id-"+t)},300)):e.error&&DLEPush.error(e.error)},"json"),!1}function ajax_save_pm_edit(t){tinyMCE.triggerSave();var e=$("#dleeditpm"+t).val();return ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=pm",{id:t,message:e,action:"save_edit_pm",user_hash:dle_login_hash},function(e){HideLoading(""),e.success?(p_cache[t]="",$("#pm-id-"+t).html(e.response),scrollToCenterPosition("#message-id-"+t),active_comments_editor=null):e.error&&DLEPush.error(e.error)},"json"),!1}function ajax_cancel_pm_edit(e){return active_comments_editor=null,""!=p_cache[e]&&$("#pm-id-"+e).html(p_cache[e]),p_cache[e]="",!1}function doSendPM(){for(var e=0,t=p_cache.length;e<t;e++)e in p_cache&&(!p_cache[e]&&""==p_cache[e]||ajax_cancel_pm_edit(e));var o=document.getElementById("dle-comments-form"),n=new FormData(o);return n.append("skin",dle_skin),ShowLoading(""),$.ajax({url:dle_root+"engine/ajax/controller.php?mod=pm",data:n,processData:!1,contentType:!1,type:"POST",dataType:"json",success:function(e){HideLoading(""),e&&(e.success?e.content?(tinyMCE.activeEditor.setContent(""),$(e.content).insertBefore("#dle-ajax-pm"),scrollToCenterPosition("#dle-ajax-pm",function(){$("#blind-animation-"+e.id).show("blind",{},500)})):e.text&&($("#dle-comments-form").html(e.text),scrollToCenterPosition("#dle-comments-form")):e.error&&(o.sec_code&&(o.sec_code.value="",reload()),"1"==dle_captcha_type?"undefined"!=typeof grecaptcha&&grecaptcha.reset():"3"==dle_captcha_type?"undefined"!=typeof hcaptcha&&hcaptcha.reset():"4"==dle_captcha_type&&"undefined"!=typeof turnstile&&turnstile.reset(),DLEPush.error(e.error)))}}),!1}function DeleteMessage(t,e,o){return DLEconfirmDelete(dle_del_agree,dle_confirm,function(){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=pm",{message_id:t,conversation_id:e,action:"del_pm",user_hash:o},function(e){HideLoading(""),e.success?scrollToCenterPosition("#message-id-"+t,function(){$("#message-id-"+t).hide("blind",{},500)}):e.error&&DLEPush.error(e.error)},"json")}),!1}function doAddComments(){var o=document.getElementById("dle-comments-form"),e="",t="",n="",i="",d="0",a="";return dle_wysiwyg&&(tinyMCE.triggerSave(),e="wysiwyg"),""==o.name.value?DLEPush.error(dle_req_field[0]):""==o.comments.value?DLEPush.error(dle_req_field[1]):(o.question_answer&&(t=o.question_answer.value),o.sec_code&&(n=o.sec_code.value),"1"==dle_captcha_type?"undefined"!=typeof grecaptcha&&(i=grecaptcha.getResponse()):"2"==dle_captcha_type?i=$("#g-recaptcha-response").val():"3"==dle_captcha_type?"undefined"!=typeof hcaptcha&&(i=hcaptcha.getResponse()):"4"==dle_captcha_type&&"undefined"!=typeof turnstile&&(i=turnstile.getResponse()),o.allow_subscribe&&1==o.allow_subscribe.checked&&(d="1"),o.mail&&(a=o.mail.value),ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=addcomments",{post_id:o.post_id.value,comments:o.comments.value,name:o.name.value,mail:a,editor_mode:e,skin:dle_skin,sec_code:n,question_answer:t,g_recaptcha_response:i,allow_subscribe:d,user_hash:dle_login_hash},function(e){var t;HideLoading(""),e.error?$("#dle-ajax-comments").append(e.content):e.success&&($("#comm-id-"+e.id).length?(t=$(e.content).find("#comm-id-"+e.id).html(),scrollToCenterPosition("#comment-id-"+e.id,function(){$("#comm-id-"+e.id).fadeOut("slow",function(){$(this).html(t+"<script>"+e.scripts+"<\/script>"),$("#comm-id-"+e.id).fadeIn("slow")})})):($(e.content+"<script>"+e.scripts+"<\/script>").insertBefore("#dle-ajax-comments"),node=$("#comments-tree-item-"+e.id).length?$("#comments-tree-item-"+e.id):$("#blind-animation-"+e.id),scrollToCenterPosition("#dle-ajax-comments",function(){$(node).show("blind",{},500)})),o.sec_code&&(o.sec_code.value="",reload()),"1"==dle_captcha_type?"undefined"!=typeof grecaptcha&&grecaptcha.reset():"3"==dle_captcha_type?"undefined"!=typeof hcaptcha&&hcaptcha.reset():"4"==dle_captcha_type&&"undefined"!=typeof turnstile&&turnstile.reset())},"json")),!1}function isHistoryApiAvailable(){return!(!window.history||!history.pushState)}function CommentsPage(t,o,n){return ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=comments",{cstart:t,news_id:o,skin:dle_skin},function(e){HideLoading(""),isNaN(t)||isNaN(o)||($("#dle-comm-link").off("click"),$("#dle-comm-link").on("click",function(){return CommentsPage(t,o),!1})),setTimeout(function(){scrollToCenterPosition("#dle-comments-list")},200),$("#dle-comments-list").html(e.comments),$(".dle-comments-navigation").html(e.navigation),isHistoryApiAvailable()&&window.history.pushState(null,null,n)},"json"),!1}function dle_copy_quote(e,t,o,n,i,d,a){dle_txt="",void 0===n&&(n="comments"),window.getSelection?dle_txt=window.getSelection().toString():document.selection&&(dle_txt=document.selection.createRange().text.toString()),""!=dle_txt&&(dle_wysiwyg||"pm"==n?(n=(n=dle_txt.replace(/\n/g,"<br>")).replace(/\r/g,""),dle_txt='<div class="quote_block noncontenteditable"><div class="title_quote" data-commenttime="'+t+'" data-commentuser="'+e+'"',void 0!==i&&void 0!==d&&(dle_txt+=' data-commentid="'+i+'"  data-commentpostid="'+d+'"'),void 0!==a&&(a="1"==a?"0":"1",dle_txt+=' data-commentgast="'+a+'"'),dle_txt+=">"+o+'</div><div class="quote"><div class="quote_body contenteditable">'+n+"</div></div></div>"):dle_txt="[quote="+e+"]"+dle_txt+"[/quote]")}function dle_fastreply(e,t){var o,n;n=null!==active_comments_editor&&document.getElementById(active_comments_editor)?(o=$("#"+active_comments_editor).find("textarea"),"#"+active_comments_editor):(active_comments_editor=null,o=$("#dle-comments-form").find("textarea"),".dleaddcomments-editor");var i="";return dle_wysiwyg?(i=t?'<span class="comments-user-profile noncontenteditable" data-username="'+encodeURI(e)+'" data-userurl="'+t+'">@'+e+"</span> ":"<b>"+e+"</b>, ",tinyMCE.execCommand("mceInsertContent",!1,i)):(o.val(o.val()+e+", "),setTimeout(function(){o.focus()},500),n=null!==active_comments_editor?"#"+active_comments_editor:"#comments"),setTimeout(function(){scrollToCenterPosition(n)},100),!1}function dle_ins(e,t){var o,n;if(void 0===t&&(t="comments"),!document.getElementById("dle-comments-form"))return!1;n=null!==active_comments_editor&&document.getElementById(active_comments_editor)?(o=$("#"+active_comments_editor).find("textarea"),"#"+active_comments_editor):(active_comments_editor=null,o=$("#dle-comments-form").find("textarea"),"pm"==t?".dlepm-editor":".dleaddcomments-editor");var i="";return""!=dle_txt?(dle_wysiwyg||"pm"==t?(i=dle_txt,tinyMCE.execCommand("mceInsertContent",!1,i+"<p><br></p>")):(o.val(o.val()+dle_txt+"\n"),setTimeout(function(){o.focus()},500),n=null!==active_comments_editor?"#"+active_comments_editor:"#comments"),setTimeout(function(){scrollToCenterPosition(n)},100)):(ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=quote",{id:e,mode:t,user_hash:dle_login_hash},function(e){HideLoading(""),e=(e=(e=(e=(e=(e=(e=e.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&")).replace(/&quot;/g,'"')).replace(/&#039;/g,"'")).replace(/&#039;/g,"'")).replace(/&#34;/g,'"'),dle_wysiwyg||"pm"==t?(i=e,tinyMCE.execCommand("mceInsertContent",!1,i+"<p><br></p>")):(o.val(o.val()+e+"\n"),setTimeout(function(){o.focus()},500),n=null!==active_comments_editor?"#"+active_comments_editor:"#comments"),setTimeout(function(){scrollToCenterPosition(n)},100)})),!1}function ShowOrHide(e){var t=$("#"+e),o=null,n=null;document.getElementById("image-"+e)&&(o=document.getElementById("image-"+e)),document.getElementById("svg-"+e)&&(n=document.getElementById("svg-"+e)),jQuery().lazyLoadXT&&$("#"+e+" *[data-src]").lazyLoadXT();var i=t.height()/200*500;1e3<i&&(i=1e3),i<250&&(i=250),"none"==t.css("display")?(t.show("blind",{},i),o&&(o.src=dle_root+"templates/"+dle_skin+"/dleimages/spoiler-minus.gif"),n&&$("#svg-"+e).attr("d","M2.582 13.891c-0.272 0.268-0.709 0.268-0.979 0s-0.271-0.701 0-0.969l7.908-7.83c0.27-0.268 0.707-0.268 0.979 0l7.908 7.83c0.27 0.268 0.27 0.701 0 0.969s-0.709 0.268-0.978 0l-7.42-7.141-7.418 7.141z")):(1e3<i&&(i=1e3),t.hide("blind",{},i),o&&(o.src=dle_root+"templates/"+dle_skin+"/dleimages/spoiler-plus.gif"),n&&$("#svg-"+e).attr("d","M17.418 6.109c0.272-0.268 0.709-0.268 0.979 0s0.271 0.701 0 0.969l-7.908 7.83c-0.27 0.268-0.707 0.268-0.979 0l-7.908-7.83c-0.27-0.268-0.27-0.701 0-0.969s0.709-0.268 0.979 0l7.419 7.141 7.418-7.141z"))}function ckeck_uncheck_all(){for(var e=document.pmlist,t=0;t<e.elements.length;t++){var o=e.elements[t];"checkbox"==o.type&&(1==e.master_box.checked?o.checked=!1:o.checked=!0)}1==e.master_box.checked?e.master_box.checked=!1:e.master_box.checked=!0}function confirmDelete(e){DLEconfirmDelete(dle_del_agree,dle_confirm,function(){document.location=e})}function setNewField(e,t){e!=selField&&(fombj=t,selField=e)}function dle_news_delete(t){var e={},o=600*getBaseSize();o>.95*$(window).width()&&(o=.95*$(window).width()),e[dle_act_lang[1]]=function(){$(this).dialog("close")},allow_dle_delete_news&&(e[dle_del_msg]=function(){$(this).dialog("close");var e={};e[dle_act_lang[3]]=function(){$(this).dialog("close")},e[dle_p_send]=function(){var e;$("#dle-promt-text").val().length<1?$("#dle-promt-text").addClass("ui-state-error"):(e=$("#dle-promt-text").val(),$(this).dialog("close"),$("#dlepopup").remove(),$.post(dle_root+"engine/ajax/controller.php?mod=message",{id:t,user_hash:dle_login_hash,text:e},function(e){"ok"==e?document.location=dle_root+"index.php?do=deletenews&id="+t+"&hash="+dle_login_hash:DLEPush.error("Send Error")}))},$("#dlepopup").remove(),$("body").append("<div id='dlepopup' class='dle-promt' title='"+dle_notice+"' style='display:none'>"+dle_p_text+"<br><br><textarea name='dle-promt-text' dir='auto' id='dle-promt-text' class='ui-widget-content ui-corner-all' style='width:97%;height:100px;'></textarea></div>"),$("#dlepopup").dialog({autoOpen:!0,width:o,resizable:!1,dialogClass:"modalfixed dle-popup-newsdelete",buttons:e}),$(".modalfixed.ui-dialog").css({position:"fixed"}),$("#dlepopup").dialog("option","position",{my:"center",at:"center",of:window})}),e[dle_act_lang[5]]={text:dle_act_lang[5],class:"ui-button-delete",click:function(){$(this).dialog("close"),document.location=dle_root+"index.php?do=deletenews&id="+t+"&hash="+dle_login_hash}},$("#dlepopup").remove(),$("body").append("<div id='dlepopup' class='dle-promt' title='"+dle_confirm+"' style='display:none'><div id='dlepopupmessage'>"+dle_del_agree+"</div></div>"),$("#dlepopup").dialog({autoOpen:!0,width:o,resizable:!1,dialogClass:"modalfixed dle-popup-newsdelete",buttons:e}),$(".modalfixed.ui-dialog").css({position:"fixed"}),$("#dlepopup").dialog("option","position",{my:"center",at:"center",of:window})}function MenuNewsBuild(e,t,o){var n=[];return void 0===o&&(o=!1),n[0]="<a onclick=\"ajax_prep_for_edit('"+e+"', '"+t+'\'); return false;" href="#">'+menu_short+"</a>",""!=dle_admin?n[1]='<a href="'+dle_root+dle_admin+"?mod=editnews&action=editnews&id="+e+'" target="_blank">'+menu_full+"</a>":n[1]='<a href="'+dle_root+"index.php?do=addnews&id="+e+'" target="_blank">'+menu_full+"</a>",allow_dle_delete_news?(n[2]="<a onclick=\"sendNotice ('"+e+'\'); return false;" href="#">'+dle_notice+"</a>",n[3]="<a onclick=\"dle_news_delete ('"+e+'\'); return false;" href="#">'+dle_del_news+"</a>"):o&&(n[2]="<a onclick=\"dle_news_delete ('"+e+'\'); return false;" href="#">'+dle_del_news+"</a>"),n}function sendNotice(t){var e={},o=600*getBaseSize();o>.95*$(window).width()&&(o=.95*$(window).width()),e[dle_act_lang[3]]=function(){$(this).dialog("close")},e[dle_p_send]=function(){var e;$("#dle-promt-text").val().length<1?$("#dle-promt-text").addClass("ui-state-error"):(e=$("#dle-promt-text").val(),$(this).dialog("close"),$("#dlepopup").remove(),$.post(dle_root+"engine/ajax/controller.php?mod=message",{id:t,user_hash:dle_login_hash,text:e,allowdelete:"no"},function(e){"ok"==e&&DLEPush.info(dle_p_send_ok)}))},$("#dlepopup").remove(),$("body").append("<div id='dlepopup' title='"+dle_notice+"' style='display:none'>"+dle_p_text+"<br><br><textarea dir='auto' name='dle-promt-text' id='dle-promt-text' class='ui-widget-content ui-corner-all' style='width:97%;height:100px;'></textarea></div>"),$("#dlepopup").dialog({autoOpen:!0,width:o,resizable:!1,dialogClass:"modalfixed dle-popup-sendmessage",buttons:e}),$(".modalfixed.ui-dialog").css({position:"fixed"}),$("#dlepopup").dialog("option","position",{my:"center",at:"center",of:window})}function AddComplaint(o,n){var e={},t="",i=600*getBaseSize();i>.95*$(window).width()&&(i=.95*$(window).width()),e[dle_act_lang[3]]=function(){$(this).dialog("close")},e[dle_p_send]=function(){var e,t;$("#dle-promt-text").val().length<1?$("#dle-promt-text").addClass("ui-state-error"):(e=$("#dle-promt-text").val(),t="",$("#dle-promt-mail").val()&&(t=$("#dle-promt-mail").val()),ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=complaint",{id:o,text:e,action:n,mail:t,user_hash:dle_login_hash},function(e){HideLoading(""),"ok"==e?($("#dlecomplaint").remove(),DLEPush.info(dle_p_send_ok)):DLEPush.error(e)}))},$("#dlecomplaint").remove(),5==dle_group&&(t=dle_mail+'<br><input type="text" dir="auto" name="dle-promt-mail" id="dle-promt-mail" class="ui-widget-content ui-corner-all" style="width:100%;" value="">'),$("body").append("<div id='dlecomplaint' title='"+dle_c_title+"' style='display:none'>"+dle_complaint+"<br><textarea dir='auto' name='dle-promt-text' id='dle-promt-text' class='ui-widget-content ui-corner-all' style='width:100%;height:140px;'></textarea>"+t+"</div>"),$("#dlecomplaint").dialog({autoOpen:!0,width:i,resizable:!1,dialogClass:"modalfixed dle-popup-complaint",buttons:e}),$(".modalfixed.ui-dialog").css({position:"fixed"}),$("#dlecomplaint").dialog("option","position",{my:"center",at:"center",of:window})}function getBaseSize(){var e=document.querySelector("html");return parseFloat(window.getComputedStyle(e).getPropertyValue("font-size"))/16}function DLEalert(e,t){var o=500*getBaseSize();o>.95*$(window).width()&&(o=.95*$(window).width()),$("#dlepopup").remove(),$("body").append("<div id='dlepopup' class='dle-alert' title='"+t+"' style='display:none'>"+e+"</div>"),$("#dlepopup").dialog({autoOpen:!0,width:o,minHeight:160,resizable:!1,dialogClass:"modalfixed dle-popup-alert",buttons:{Ok:function(){$(this).dialog("close"),$("#dlepopup").remove()}}}),$(".modalfixed.ui-dialog").css({position:"fixed"}),$("#dlepopup").dialog("option","position",{my:"center",at:"center",of:window})}function DLEconfirm(e,t,o){var n={},i=500*getBaseSize();i>.95*$(window).width()&&(i=.95*$(window).width()),n[dle_act_lang[1]]=function(){$(this).dialog("close"),$("#dlepopup").remove()},n[dle_act_lang[0]]=function(){$(this).dialog("close"),$("#dlepopup").remove(),o&&o()},$("#dlepopup").remove(),$("body").append("<div id='dlepopup' class='dle-confirm' title='"+t+"' style='display:none'>"+e+"</div>"),$("#dlepopup").dialog({autoOpen:!0,width:i,minHeight:160,resizable:!1,dialogClass:"modalfixed dle-popup-confirm",buttons:n}),$(".modalfixed.ui-dialog").css({position:"fixed"}),$("#dlepopup").dialog("option","position",{my:"center",at:"center",of:window})}function DLEconfirmDelete(e,t,o){var n=500*getBaseSize();n>.95*$(window).width()&&(n=.95*$(window).width()),$("#dlepopup").remove(),$("body").append("<div id='dlepopup' class='dle-confirm' title='"+t+"' style='display:none'>"+e+"</div>"),$("#dlepopup").dialog({autoOpen:!0,width:n,minHeight:160,resizable:!1,buttons:[{text:dle_act_lang[1],click:function(){$(this).dialog("close"),$("#dlepopup").remove()}},{text:dle_act_lang[5],class:"ui-button-delete",click:function(){$(this).dialog("close"),$("#dlepopup").remove(),o&&o()}}]})}function DLEprompt(e,t,o,n,i,d){var a={},l=500*getBaseSize();l>.95*$(window).width()&&(l=.95*$(window).width()),void 0===d&&(d="text"),a[dle_act_lang[3]]=function(){$(this).dialog("close")},a[dle_act_lang[2]]=function(){var e;!i&&$("#dle-promt-text").val().length<1?$("#dle-promt-text").addClass("ui-state-error"):(e=$("#dle-promt-text").val(),$(this).dialog("close"),$("#dlepopup").remove(),n&&n(e))},$("#dlepopup").remove(),$("body").append("<div id='dlepopup' class='dle-promt' title='"+o+"' style='display:none'>"+e+"<br><br><input type='"+d+"' dir='auto' name='dle-promt-text' id='dle-promt-text' class='ui-widget-content ui-corner-all' style='width:97%;' value='"+t+"'/></div>"),$("#dlepopup").dialog({autoOpen:!0,width:l,resizable:!1,dialogClass:"modalfixed dle-popup-promt",buttons:a}),$(".modalfixed.ui-dialog").css({position:"fixed"}),$("#dlepopup").dialog("option","position",{my:"center",at:"center",of:window}),(0<t.length?$("#dle-promt-text").select():$("#dle-promt-text")).focus()}var dle_user_profile="",dle_user_profile_link="";function ShowPopupProfile(e,t){var o={},n=550*getBaseSize();return n>.95*$(window).width()&&(n=.95*$(window).width()),o[menu_profile]=function(){document.location=dle_user_profile_link},5!=dle_group&&(o[menu_send]=function(){$(this).dialog("close"),$("#dleuserpopup").remove(),DLESendPM(dle_user_profile)}),1==t&&(o[menu_uedit]=function(){$(this).dialog("close");var e={};return $("body").append('<div id="modal-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #666666; opacity: .40;filter:Alpha(Opacity=40); z-index: 980; display:none;"></div>'),$("#modal-overlay").css({filter:"alpha(opacity=40)"}).fadeIn("slow"),$("#dleuserpopup").remove(),$("body").append("<div id='dleuserpopup' title='"+menu_uedit+"' style='display:none'></div>"),e[dle_act_lang[5]]={text:dle_act_lang[5],class:"ui-button-delete",click:function(){window.frames.edituserframe.confirmDelete(dle_login_hash)}},e[dle_act_lang[3]]=function(){$(this).dialog("close"),$("#dleuserpopup").remove()},e[dle_act_lang[4]]=function(){document.getElementById("edituserframe").contentWindow.document.getElementById("saveuserform").submit()},$("#dleuserpopup").dialog({autoOpen:!0,width:700,resizable:!1,dialogClass:"modalfixed dle-popup-userprofileadmin",buttons:e,open:function(e,t){$("#dleuserpopup").html("<iframe name='edituserframe' id='edituserframe' width='100%' height='400' src='"+dle_root+dle_admin+"?mod=editusers&action=edituser&user="+dle_user_profile+"&skin="+dle_skin+"' frameborder='0' marginwidth='0' marginheight='0' allowtransparency='true'></iframe>")},beforeClose:function(e,t){$("#dleuserpopup").html("")},close:function(e,t){$("#modal-overlay").fadeOut("slow",function(){$("#modal-overlay").remove()})}}),830<$(window).width()&&530<$(window).height()&&($(".modalfixed.ui-dialog").css({position:"fixed"}),$("#dleuserpopup").dialog("option","position",{my:"center",at:"center",of:window})),!1}),$("#dleprofilepopup").remove(),$("body").append(e),$("#dleprofilepopup").dialog({autoOpen:!0,resizable:!1,dialogClass:"dle-popup-userprofile",buttons:o,width:n}),!1}function onTwofactoryChange(t,e){if(!e)return!1;var o=550*getBaseSize();o>.95*$(window).width()&&(o=.95*$(window).width());var e=$(t).val(),n=$("#twofactor_auth_prev").val();return e&&2==e&&e!=n&&(ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=twofactor",{mode:"createsecret",skin:dle_skin,user_hash:dle_login_hash},function(e){HideLoading(""),$("#dletwofactorsecret").remove(),$("body").append("<div id='dletwofactorsecret' title='"+dle_confirm+"' style='display:none'>"+e+"</div>");e={};e[dle_act_lang[3]]=function(){$(t).val(n),$("#dletwofactorsecret").remove()},e[dle_act_lang[4]]=function(){var e;$("#dle-promt-text").val().length<1?$("#dle-promt-text").addClass("ui-state-error"):(e=$("#dle-promt-text").val(),ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=twofactor",{mode:"verifysecret",pin:e,skin:dle_skin,user_hash:dle_login_hash},function(e){HideLoading(""),e.success?($("#twofactor_auth_prev").val("2"),$("#dletwofactorsecret").remove(),DLEPush.info(e.message)):e.error&&(DLEPush.error(e.errorinfo),$(".dle-popup-twofactor-secret").css("max-height",""),$("#dletwofactorsecret").css("height","auto"))},"json"))},$("#dletwofactorsecret").dialog({autoOpen:!0,show:"fade",hide:"fade",width:o,resizable:!1,dialogClass:"dle-popup-twofactor-secret",buttons:e})})),!1}function ShowProfile(e,t,o){return dle_user_profile==e&&document.getElementById("dleprofilepopup")?$("#dleprofilepopup").dialog("open"):(dle_user_profile=e,dle_user_profile_link=t,ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=profile",{name:e,skin:dle_skin,user_hash:dle_login_hash},function(e){HideLoading(""),ShowPopupProfile(e,o)})),!1}function FastSearch(){$("#story").attr("autocomplete","off"),$("#story").blur(function(){$("#searchsuggestions").fadeOut()}),$("#story").keyup(function(){var e=$(this).val();0==e.length?$("#searchsuggestions").fadeOut():dle_search_value!=e&&e.length>=dle_min_search&&(clearInterval(dle_search_delay),dle_search_delay=setInterval(function(){dle_do_search(e)},600))})}function dle_do_search(e){clearInterval(dle_search_delay),$("#searchsuggestions").remove(),$("body").append("<div id='searchsuggestions' style='display:none'></div>"),$.post(dle_root+"engine/ajax/controller.php?mod=search",{query:""+e,skin:dle_skin,user_hash:dle_login_hash},function(e){$("#searchsuggestions").html(e).fadeIn().css({position:"absolute",top:0,left:0}).position({my:"left top",at:"left bottom",of:"#story"})}),dle_search_value=e}function ShowLoading(e,t,o){var n="";void 0===t&&(t="center"),void 0===o&&(o="center"),void 0===e&&(e=""),$("#loading-layer").remove(),0!==e.length&&e.trim()?(n="withtext",e="<span>"+e+"</span>"):(e='<svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" width="32px" height="32px" viewBox="0 0 128 128" xml:space="preserve"><g><path fill="#ffffff" d="M64,128a64,64,0,1,1,64-64A64,64,0,0,1,64,128ZM64,2.75A61.25,61.25,0,1,0,125.25,64,61.25,61.25,0,0,0,64,2.75Z"/><path fill="#ffffff" d="M64 128a64 64 0 1 1 64-64 64 64 0 0 1-64 64zM64 2.75A61.2 61.2 0 0 0 3.34 72.4c1.28-3.52 3.9-6.32 7.5-6.86 6.55-1 11.9 2.63 13.6 8.08 3.52 11.27.5 23 15 35.25 19.47 16.46 40.34 13.54 52.84 9.46A61.25 61.25 0 0 0 64 2.75z"/><animateTransform attributeName="transform" type="rotate" from="0 64 64" to="360 64 64" dur="1400ms" repeatCount="indefinite"></animateTransform></g></svg>',n="withouttext"),$("body").append('<div id="loading-layer" class="'+n+'" style="display:none">'+e+"</div>");var i=($(window).width()-$("#loading-layer").outerWidth())/2,d=($(window).height()-$("#loading-layer").outerHeight())/2;switch(t){case"left":i=15;break;case"right":i=$(window).width()-$("#loading-layer").outerWidth()-15}switch(o){case"top":d=15;break;case"bottom":d=$(window).height()-$("#loading-layer").outerHeight()-15}$("#loading-layer").css({left:i+"px",top:d+"px",position:"fixed",zIndex:"9999"}),$("#loading-layer").fadeTo(300,1)}function HideLoading(e){$("#loading-layer").fadeOut(300,function(){$("#loading-layer").remove()})}function ShowAllVotes(){var t=600*getBaseSize();return t>.95*$(window).width()&&(t=.95*$(window).width()),document.getElementById("dlevotespopup")?$("#dlevotespopup").dialog("open"):($.ajaxSetup({cache:!1}),ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=allvotes&dle_skin="+dle_skin,function(e){HideLoading(""),$("#dlevotespopup").remove(),$("body").append(e),$(".dlevotebutton").button(),$("#dlevotespopup").dialog({autoOpen:!0,resizable:!1,dialogClass:"dle-popup-allvotes",width:t}),400<$("#dlevotespopupcontent").height()&&$("#dlevotespopupcontent").height(400),$("#dlevotespopup").dialog("option","height",$("#dlevotespopupcontent").height()+60),$("#dlevotespopup").dialog("option","position","center")})),!1}function fast_vote(t){var e=$("#vote_"+t+" input:radio[name=vote_check]:checked").val();return void 0===e||(ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=vote",{vote_id:t,vote_action:"vote",vote_mode:"fast_vote",vote_check:e,dle_skin:dle_skin,user_hash:dle_login_hash},function(e){HideLoading(""),$("#dle-vote_list-"+t).fadeOut(500,function(){$(this).html(e),$(this).fadeIn(500)})})),!1}function AddIgnorePM(e,t){DLEconfirm(t,dle_confirm,function(){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=adminfunction",{id:e,action:"add_ignore",skin:dle_skin,user_hash:dle_login_hash},function(e){return HideLoading(""),e.success?DLEPush.info(e.success):e.error&&DLEPush.error(e.error),!1},"json")})}function DelIgnorePM(t,e){return DLEconfirm(e,dle_confirm,function(){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=adminfunction",{id:t,action:"del_ignore",skin:dle_skin,user_hash:dle_login_hash},function(e){return HideLoading(""),$("#dle-ignore-list-"+t).html(""),DLEPush.info(e),!1})}),!1}function DelSocial(t,e){return DLEconfirmDelete(e,dle_confirm,function(){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=adminfunction",{id:t,action:"del_social",user_hash:dle_login_hash},function(e){return HideLoading(""),$("#dle-social-list-"+t).html(""),DLEPush.info(e),!1})}),!1}function subscribe(e,t){var o=dle_sub_agree;return 0==t&&(o=dle_unsub_agree),DLEconfirm(o,dle_confirm,function(){ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php?mod=commentssubscribe",{news_id:e,skin:dle_skin,sub_action:t,user_hash:dle_login_hash},function(e){HideLoading(""),e.success?DLEPush.info(e.info):e.error&&DLEPush.error(e.errorinfo)},"json")}),!1}var media_upload_manager=!1;function media_upload(e,t,o,n){var i=e+t+o+n;return $("#mediaupload").hasClass("ui-dialog-content")&&media_upload_manager==i?($("#mediaupload").dialog("open"),check_all()):($("#mediaupload").remove(),$("body").append("<div id='mediaupload' class='mediaupload-body' title='"+text_upload+"' style='display:none'></div>"),ShowLoading(""),$.get(dle_root+"engine/ajax/controller.php",{mod:"upload",area:e,news_id:o,author:t,wysiwyg:n},function(e){HideLoading(""),$("#mediaupload").html(e);var t=900*getBaseSize();t>.95*$(window).width()&&(t=.95*$(window).width());e=.9*$(window).height();600<e&&(e=600),$("#mediaupload").dialog({autoOpen:!0,width:t,height:e,resizable:!1,dialogClass:"modalfixed dle-popup-mediaupload",open:function(e,t){$(".dle-popup-mediaupload").append($("#mediaupload-buttonpane").html()),$("#mediaupload-buttonpane").remove()},dragStart:function(e,t){$("#mediaupload").css("visibility","hidden"),$(".modalfixed").fadeTo(0,.8)},dragStop:function(e,t){$("#mediaupload").css("visibility","visible"),$(".modalfixed").fadeTo(0,1)}}),media_upload_manager=i,830<$(window).width()&&530<$(window).height()&&($(".modalfixed.ui-dialog").css({position:"fixed"}),$("#mediaupload").dialog("option","position",{my:"center",at:"center",of:window}))},"html")),!1}function dropdownmenu(e,t,o,n){t.stopPropagation();var i=$("#dropmenudiv");if(i.is(":visible"))return clearhidemenu(),i.fadeOut("fast"),!1;i.remove(),$("body").append('<div id="dropmenudiv" style="display:none;position:absolute;z-index:1000;width:auto;"></div>'),(i=$("#dropmenudiv")).html(o.join(""));t=$(document).width()-30,o=$(e).offset();return t-o.left<i.outerWidth()&&(o.left=o.left-(i.outerWidth()-$(e).outerWidth())),i.css({left:o.left+"px",top:o.top+$(e).outerHeight()+"px"}),i.fadeIn("fast"),i.on("mouseenter",function(){clearhidemenu()}),i.on("mouseleave",function(){delayhidemenu()}),$(document).one("click",function(){hidemenu()}),!1}function setcookie(e,t){var o=new Date;o.setTime(o.getTime()+26784e5);o="expires="+o.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"}function get_local_storage(e){try{return localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):null}catch(e){return null}}function set_local_storage(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){}}function del_local_storage(e,t){try{localStorage.removeItem(e)}catch(e){}}function save_last_viewed(e){if(e=parseInt(e),isNaN(e))return null;var t=get_local_storage("viewed_ids");return Array.isArray(t)?-1==$.inArray(e,t)&&(19<t.length&&t.pop(),t.unshift(e)):(t=[]).push(e),set_local_storage("viewed_ids",t),setcookie("viewed_ids",t.join()),!0}function hidemenu(e){$("#dropmenudiv").fadeOut("fast")}function delayhidemenu(){delayhide=setTimeout("hidemenu()",1e3)}function clearhidemenu(){"undefined"!=typeof delayhide&&clearTimeout(delayhide)}function removeEmptyElements(e){for(var t=[],o=0;o<e.length;o++)""!==e[o]&&t.push(e[o]);return t}function find_comment_onpage(){var e,t;window.location.hash&&("findcomment"!=(e=window.location.hash).slice(1,12)||(t=e.slice(12))&&document.getElementById("comment-id-"+t)&&setTimeout(function(){scrollToCenterPosition("#comment-id-"+t,function(){scrollToCenterPosition("#comment-id-"+t,null,1)},700)},400))}function findCommentsPage(o,n,e){var i=$(o).attr("href"),d="#comment",a=!0;return $(o).css("pointer-events","none"),ShowLoading(""),$.post(dle_root+"engine/ajax/controller.php?mod=adminfunction",{action:"findcommentspage",comment_id:n,post_id:e,user_hash:dle_login_hash},function(e){$(o).css("pointer-events","auto"),HideLoading(""),e&&(e.url&&(i=e.url,a=!1),"ok"==e.status&&e.page&&(1<e.page&&(t=(i=i.replace(/https?:\/\//,"")).split("/"),dle_link_type?t[t.length-1]="page,1,"+e.page+","+t[t.length-1]:t[t.length-1]=t[t.length-1]+"&cstart="+e.page,t=removeEmptyElements(t),i=a?"//"+t.join("/"):"/"+t.join("/")),d="#findcomment"+n));var t=!1;document.location.pathname==i&&(t=!0),i+=d,document.location.href=i,t&&find_comment_onpage()},"json").fail(function(e){HideLoading(""),i+=d,document.location=i}),!1}function scrollToCenterPosition(e,t,o){var n=$(e),i=n.offset().top,e=$(window).height(),n=n.outerHeight();void 0===o&&(o=400),n=e-100<n||0==n?i-e/4:i-e/2+n/2,void 0===t||null==t?$("html,body").stop().animate({scrollTop:n},o):$("html,body").stop().animate({scrollTop:n},o,t)}function DLEPasteSafeText(e,t){var o,n;return void 0!==e.node.innerHTML&&(n=e.node.innerHTML,t&&(o=[],n=(n=n.replace(/<a[^>]*?href=["'](https?:\/\/[^\s<]+)["'][^>]*?>.*?<\/a>/gi,e=>{return o.push(e),"__LINK"+(o.length-1)+"__"})).replace(/(https?:\/\/[^\s<]+)/g,'<a href="$1" target="_blank">$1</a>'),o.forEach((e,t)=>{n=n.replace("__LINK"+t+"__",e)})),e.node.innerHTML=n),e}jQuery(function(n){var o=!1,e=new Array,i="";n(document).keydown(function(e){if(13==e.which&&e.ctrlKey){var t;if(e.preventDefault(),window.getSelection?t=window.getSelection():document.getSelection?t=document.getSelection():document.selection&&(t=document.selection.createRange().text),""==t)return!1;if(255<t.toString().length)return DLEPush.error(dle_big_text),!1;var o={},e=600*getBaseSize();e>.95*n(window).width()&&(e=.95*n(window).width()),o[dle_act_lang[3]]=function(){n(this).dialog("close")},o[dle_p_send]=function(){var e,t,o;n("#dle-promt-text").val().length<1?n("#dle-promt-text").addClass("ui-state-error"):(e=n("#dle-promt-text").val(),t=n("#orfom").text(),o="",n("#dle-promt-mail").val()&&(o=n("#dle-promt-mail").val()),ShowLoading(""),n.post(dle_root+"engine/ajax/controller.php?mod=complaint",{seltext:t,text:e,mail:o,user_hash:dle_login_hash,action:"orfo",url:window.location.href},function(e){HideLoading(""),"ok"==e?(n("#dlecomplaint").remove(),DLEPush.info(dle_p_send_ok)):DLEPush.error(e)}))},n("#dlecomplaint").remove(),5==dle_group&&(i=dle_mail+'<br><input type="text"  dir="auto" name="dle-promt-mail" id="dle-promt-mail" class="ui-widget-content ui-corner-all" style="width:100%;" value="">'),n("body").append("<div id='dlecomplaint' class='dle-promt' title='"+dle_c_title+"' style='display:none'>"+dle_orfo_title+"<br><textarea dir='auto' name='dle-promt-text' id='dle-promt-text' class='ui-widget-content ui-corner-all' style='width:100%;height:140px;'></textarea>"+i+"<div id='orfom' style='display:none'>"+t+"</div></div>"),n("#dlecomplaint").dialog({autoOpen:!0,width:e,resizable:!1,dialogClass:"modalfixed dle-popup-complaint",buttons:o}),n(".modalfixed.ui-dialog").css({position:"fixed"}),n("#dlecomplaint").dialog("option","position",{my:"center",at:"center",of:window})}}),setTimeout(function(){n("img[data-maxwidth]").each(function(){var e=n(this).width(),t=n(this).data("maxwidth");n(this)[0].naturalWidth&&(e=n(this)[0].naturalWidth),t<e&&(n(this).width(t),n(this).wrap('<a href="'+n(this).attr("src")+'" data-highslide="single" target="_blank"></a>'),"undefined"==typeof Fancybox&&0==o&&(o=!0,n.getCachedScript(dle_root+"engine/classes/fancybox/fancybox.js")))})},300),setTimeout(function(){n("div[data-dlebclicks]").each(function(){var e=n(this).data("dlebid");n(this).find("a").on("click",function(){n.post(dle_root+"engine/ajax/controller.php?mod=adminfunction",{id:e,action:"bannersclick",user_hash:dle_login_hash})})})},400),n("div[data-dlebviews]").each(function(){e.push(n(this).data("dlebid"))}),e.length&&setTimeout(function(){n.post(dle_root+"engine/ajax/controller.php?mod=adminfunction",{"ids[]":e,action:"bannersviews",user_hash:dle_login_hash})},1e3),n(document).on("click",".comments-user-profile",function(e){return n(this).data("userurl")&&n(this).data("username")&&ShowProfile(n(this).data("username"),n(this).data("userurl"),0),!1})}),jQuery.getCachedScript=function(e,t){return t=$.extend(t||{},{dataType:"script",cache:!0,url:e}),jQuery.ajax(t)};